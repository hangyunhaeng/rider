<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="stsDAO">
	<select id="selectBalanceConfirmList" parameterType="egovframework.com.rd.usr.service.vo.BalanceVO" resultType="egovframework.com.rd.usr.service.vo.BalanceVO">
		<if test="schIdx !=0 and schPagePerCnt != 0">
		SELECT * FROM (
			SELECT ROWNUM() RN,m.*
			FROM (
		</if>
				SELECT a.COOPERATOR_ID, a.ESNTL_ID, b.mber_id, a.DAY
				<![CDATA[
					, if(a.BALANCE1 <0 , BALANCE0+BALANCE1, BALANCE0) AS BALANCE0 , if(a.BALANCE1 <0 , 0, BALANCE1) AS BALANCE1
					, if(a.ABLE_BALANCE1 <0 , ABLE_BALANCE0+ABLE_BALANCE1, ABLE_BALANCE0) AS ABLE_BALANCE0 , if(a.ABLE_BALANCE1 <0 , 0, ABLE_BALANCE1) AS ABLE_BALANCE1
				]]>
					, b.MBER_NM, c.COOPERATOR_NM
					, if(a.ESNTL_ID = #{cooperatorMberId}, '협력사', '라이더') AS GUBUN_NM
				FROM RD_BALANCE_CONFIRM a
				LEFT JOIN COMTNGNRLMBER b ON a.ESNTL_ID = b.ESNTL_ID
				LEFT JOIN RD_COOPERATOR c ON a.COOPERATOR_ID = c.COOPERATOR_ID
				LEFT JOIN COMTNEMPLYRINFO d ON a.ESNTL_ID = d.ESNTL_ID
				WHERE DAY BETWEEN #{searchFromDate} AND #{searchToDate}
				<if test='searchCooperatorId != "all" and searchGubun == "R"'>
				AND a.ESNTL_ID != #{cooperatorMberId}
				</if>
				<if test='searchCooperatorId != "all" and searchGubun == "C"'>
				AND a.ESNTL_ID = #{cooperatorMberId}
				</if>

		<if test="schIdx !=0 and schPagePerCnt != 0">
			) m
		) m
		<![CDATA[WHERE RN > #{schIdx}*#{schPagePerCnt} -#{schPagePerCnt} AND RN <= #{schIdx}*#{schPagePerCnt}]]>
		</if>
	</select>


	<select id="selectBalanceConfirmListCnt" parameterType="egovframework.com.rd.usr.service.vo.BalanceVO" resultType="egovframework.com.rd.usr.service.vo.BalanceVO">
		SELECT COUNT(COOPERATOR_ID) AS TOTAL_CNT
		FROM RD_BALANCE_CONFIRM
		WHERE DAY BETWEEN #{searchFromDate} AND #{searchToDate}
			<if test='searchCooperatorId != "all" and searchGubun == "R"'>
			AND mber_id != #{cooperatorMberId}
			</if>
			<if test='searchCooperatorId != "all" and searchGubun == "C"'>
			AND mber_id = #{cooperatorMberId}
			</if>
	</select>
</mapper>